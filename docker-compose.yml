# FHIR VAD：Validator + 網頁介面
# 啟動：docker compose up -d
# 介面：http://localhost:5500/
# 推送到 Docker Hub：docker compose build && docker push dear7601/fhir-vad:latest

services:
  validator:
    build: .
    image: dear7601/fhir-vad:latest
    command: ["python3", "start_validator.py", "--port", "8080"]
    ports:
      - "8080:8080"
    # 關閉術語驗證可加快啟動並避免網路依賴（可選）：
    # command: ["python3", "start_validator.py", "--port", "8080", "-tx", "na"]
    # 共用術語快取目錄（可選）：
    # volumes:
    #   - fhir-tx-cache:/app/fhir-tx-cache
    # command: ["python3", "start_validator.py", "--port", "8080", "--txCache", "/app/fhir-tx-cache"]

  web:
    build: .
    image: dear7601/fhir-vad:latest
    command: ["python3", "serve_with_proxy.py"]
    environment:
      VAD_BACKEND: http://validator:8080/validateResource
    ports:
      - "5500:5500"
    depends_on:
      - validator

# volumes:
#   fhir-tx-cache:
